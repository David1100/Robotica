---
import { getData } from "@/utils/fetchData";
import { functionToken } from "@/utils/functions";
import { Icon } from "astro-icon/components";
export const prerender = true;


const { item_detalles, slug } = Astro.props;
const yaInscrito = Astro.url.searchParams.get("yaInscrito");


const resCourseDetail = await getData(
    `?wstoken=${functionToken(null)}&wsfunction=core_course_get_courses_by_field&moodlewsrestformat=json&field=shortname&value=${slug}`,
);

// const resUser = await getData(
//     `?wstoken=${functionToken(null)}&wsfunction=core_enrol_get_users_courses&moodlewsrestformat=json&userid=3`,
// );
// const cursos_item_usser = resUser;

const resDetail = resCourseDetail.courses[0];

// const yaInscrito = cursos_item_usser.some(
//     (curso: any) => curso.id === resDetail.id,
// );
---

{
    yaInscrito === "true" ? null : (
        <div class="px-4 py-12 lg:px-12 lg:py-12 relative backdrop-blur-xs rounded-xl shadow-lg shadow-bgPrimary/30">
            <Icon
                name={"certificate"}
                size={60}
                class="text-bgPrimary absolute right-4 top-2 animate-tada animate-iteration-count-infinite"
            />

            {/* Imagen difuminada de fondo */}
            <div class="absolute inset-0 -z-10">
                <img
                    src={resDetail.courseimage}
                    alt="Fondo"
                    class="w-full h-full object-cover blur-xs opacity-40"
                />
            </div>

            <span class="text-bgPrimary drop-shadow-md text-sm font-semibold">
                Aplica solo para estudiantes con kit Workstation.
            </span>

            <h1 class="text-2xl lg:text-3xl xl:text-4xl font-semibold mb-4 leading-tight drop-shadow-md text-balance">
                Compra para desbloquear esta{" "}
                <span class="text-bgPrimary">misión</span>
            </h1>

            <h2 class="text-lg drop-shadow-md text-gray-600">
                Desata tu potencial en robótica y accede a formación exclusiva.
            </h2>

            <div class="mt-4 grid grid-cols-2 gap-2 lg:text-sm text-xs drop-shadow-md">
                {item_detalles.map((item: any) => (
                    <div class="border-[1px] border-bgPrimary/10 p-2 rounded-lg bg-bgPrimary text-white flex items-center gap-1 hover:scale-105 transition-all ">
                        <Icon name={"check"} class={"text-white"} size={22} />
                        {item.text}
                    </div>
                ))}
            </div>
        </div>
    )
}
